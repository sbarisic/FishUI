# IFishUIForm - Designer-Generated Forms Guide

This guide explains how to use `IFishUIForm` and designer-generated forms in FishUI. These forms are created by the FishUI Layout Editor's "Export as C#" feature and provide a clean separation between auto-generated layout code and user logic.

## Table of Contents

1. [Overview](#overview)
2. [Creating a Form](#creating-a-form)
3. [Using Designer-Generated Forms](#using-designer-generated-forms)
4. [The IFishUIForm Interface](#the-ifishuiform-interface)
5. [Partial Class Pattern](#partial-class-pattern)
6. [Event Handlers](#event-handlers)
7. [Best Practices](#best-practices)

---

## Overview

`IFishUIForm` is an interface that defines the contract for designer-generated form classes. When you design a layout in the FishUI Layout Editor and export it as C#, it generates a `.Designer.cs` file that implements this interface.

**Benefits:**
- Visual layout design with the FishUI Layout Editor
- Clean separation of auto-generated code and user logic
- Familiar partial class pattern (similar to WinForms)
- Easy regeneration when layouts change

---

## Creating a Form

### Step 1: Design in FishUI Layout Editor

1. Open the FishUI Layout Editor
2. Design your form by dragging controls from the toolbox
3. Set properties in the PropertyGrid
4. Save your layout as a `.yaml` file

### Step 2: Export as C#

1. In the Layout Editor, select **File â†’ Export as C#...**
2. Choose a location and filename (e.g., `MainForm.Designer.cs`)
3. The editor generates a partial class implementing `IFishUIForm`

### Step 3: Create User Code File

Create a companion file for your event handlers and custom logic:

```csharp
// MainForm.cs - User code
using FishUI;
using FishUI.Controls;

namespace MyApp.Forms
{
    public partial class MainForm
    {
        // Override OnLoaded to wire up event handlers
        public override void OnLoaded()
        {
            btnSubmit.OnButtonPressed += OnSubmitClicked;
            txtName.OnTextChanged += OnNameChanged;
        }

        private void OnSubmitClicked(Button sender, FishMouseButton btn, Vector2 pos)
        {
            // Handle button click
            Console.WriteLine($"Submitted: {txtName.Text}");
        }

        private void OnNameChanged(string newText)
        {
            // Handle text change
            btnSubmit.Disabled = string.IsNullOrEmpty(newText);
        }
    }
}
```

---

## Using Designer-Generated Forms

### Basic Usage

```csharp
using FishUI;
using MyApp.Forms;

// Create FishUI instance
FishUI fishUI = new FishUI(settings, gfx, input, events);
fishUI.Init();
settings.LoadTheme("data/themes/default.yaml", applyImmediately: true);

// Create and load the form
IFishUIForm form = new MainForm();
form.LoadControls(fishUI);
form.OnLoaded();

// Main loop
while (running)
{
    fishUI.Tick(deltaTime, totalTime);
}
```

### With ISample Pattern

```csharp
public class SampleMyForm : ISample
{
    private FishUI FUI;
    private IFishUIForm _form;

    public FishUI CreateUI(FishUISettings settings, IFishUIGfx gfx, 
                           IFishUIInput input, IFishUIEvents events)
    {
        FUI = new FishUI(settings, gfx, input, events);
        FUI.Init();
        settings.LoadTheme("data/themes/default.yaml", applyImmediately: true);
        return FUI;
    }

    public void Init()
    {
        // Load the designer-generated form
        _form = new MainForm();
        _form.LoadControls(FUI);
        _form.OnLoaded();
    }
}
```

---

## The IFishUIForm Interface

```csharp
public interface IFishUIForm
{
    /// <summary>
    /// Initializes FishUI with settings. Override for custom initialization.
    /// </summary>
    void Init(FishUISettings UISettings, IFishUIGfx Gfx, 
              IFishUIInput Input, IFishUIEvents Events);

    /// <summary>
    /// Creates all controls and adds them to FishUI.
    /// Auto-generated by the Layout Editor.
    /// </summary>
    void LoadControls(FishUI FUI);

    /// <summary>
    /// Called after controls are loaded. Override to add event handlers.
    /// </summary>
    void OnLoaded();
}
```

### Method Details

| Method | Purpose | Who Implements |
|--------|---------|----------------|
| `Init()` | Optional FishUI initialization | User (if needed) |
| `LoadControls()` | Create and configure all controls | Auto-generated |
| `OnLoaded()` | Wire up event handlers | User |

---

## Partial Class Pattern

Designer-generated forms use the partial class pattern to separate auto-generated code from user code:

### Auto-Generated File (MainForm.Designer.cs)

```csharp
// <auto-generated>
//     This code was generated by FishUI Layout Editor.
//     Changes to this file may be overwritten when regenerating.
// </auto-generated>

namespace MyApp.Forms
{
    public partial class MainForm : IFishUIForm
    {
        #region Control Fields
        
        protected Window mainWindow;
        protected Button btnSubmit;
        protected Textbox txtName;
        
        #endregion

        public void Init(FishUISettings UISettings, IFishUIGfx Gfx, 
                         IFishUIInput Input, IFishUIEvents Events)
        {
            // Override in user code if needed
        }

        public void LoadControls(FishUI FUI)
        {
            // Auto-generated control creation
            mainWindow = new Window();
            mainWindow.Position = new Vector2(100, 100);
            mainWindow.Size = new Vector2(400, 300);
            mainWindow.Title = "My Form";

            btnSubmit = new Button();
            btnSubmit.Position = new Vector2(16, 240);
            btnSubmit.Size = new Vector2(100, 28);
            btnSubmit.Text = "Submit";

            txtName = new Textbox();
            txtName.Position = new Vector2(16, 60);
            txtName.Size = new Vector2(200, 24);

            mainWindow.AddChild(btnSubmit);
            mainWindow.AddChild(txtName);

            FUI.AddControl(mainWindow);
        }

        public virtual void OnLoaded()
        {
            // Override in user code
        }
    }
}
```

### User Code File (MainForm.cs)

```csharp
namespace MyApp.Forms
{
    public partial class MainForm
    {
        public override void OnLoaded()
        {
            btnSubmit.OnButtonPressed += OnSubmitClicked;
        }

        private void OnSubmitClicked(Button sender, FishMouseButton btn, Vector2 pos)
        {
            MessageBox.Show($"Hello, {txtName.Text}!");
        }
    }
}
```

---

## Event Handlers

### Common Control Events

```csharp
public override void OnLoaded()
{
    // Button click
    myButton.OnButtonPressed += (sender, btn, pos) => { /* handle */ };

    // Text changed
    myTextbox.OnTextChanged += (newText) => { /* handle */ };

    // Selection changed (ListBox, DropDown)
    myListBox.OnSelectionChanged += (index, item) => { /* handle */ };

    // Value changed (Slider, NumericUpDown)
    mySlider.OnValueChanged += (newValue) => { /* handle */ };

    // Checkbox toggled
    myCheckbox.OnCheckedChanged += (isChecked) => { /* handle */ };

    // Window closed
    myWindow.OnClosePressed += () => { /* handle */ };
}
```

### Accessing Controls

All controls declared in the designer are `protected` fields, accessible from your user code:

```csharp
public override void OnLoaded()
{
    // Access any control by its DesignerName
    lblStatus.Text = "Ready";
    btnSubmit.Disabled = true;
    
    // Populate a listbox
    cmbCountry.Items.AddRange(new[] { "USA", "UK", "Canada" });
}
```

---

## Best Practices

### 1. Don't Edit Designer.cs Files

The `.Designer.cs` file is auto-generated and will be overwritten when you re-export. Put all your custom code in the companion `.cs` file.

### 2. Use Meaningful DesignerNames

In the Layout Editor, set the `DesignerName` property to meaningful names:
- `btnSubmit` instead of `button1`
- `txtEmail` instead of `textbox3`
- `lstProducts` instead of `listBox1`

### 3. Initialize Data in OnLoaded

Populate controls with data in `OnLoaded()`, not in `LoadControls()`:

```csharp
public override void OnLoaded()
{
    // Good - populate data here
    PopulateProductList();
    LoadUserPreferences();
    
    // Wire up events
    btnRefresh.OnButtonPressed += OnRefreshClicked;
}

private void PopulateProductList()
{
    lstProducts.Items.Clear();
    foreach (var product in _dataService.GetProducts())
    {
        lstProducts.Items.Add(product.Name);
    }
}
```

### 4. Handle Multiple Forms

You can have multiple forms in a single application:

```csharp
private MainForm _mainForm;
private SettingsForm _settingsForm;

public void Init()
{
    _mainForm = new MainForm();
    _mainForm.LoadControls(FUI);
    _mainForm.OnLoaded();
    
    // Settings form - hidden initially
    _settingsForm = new SettingsForm();
    _settingsForm.LoadControls(FUI);
    _settingsForm.OnLoaded();
    _settingsForm.MainWindow.Visible = false;
}
```

### 5. Keep Forms Focused

Each form should have a single responsibility. Use separate forms for:
- Main application window
- Settings/preferences dialog
- About dialog
- Data entry forms

---

## See Also

- [FishUI Layout Editor](../FishUIEditor/) - Visual layout designer
- [DesignerCodeGenerator.cs](../FishUI/DesignerCodeGenerator.cs) - Code generation implementation
- [SampleDesignerForm.cs](../FishUIDemos/Samples/SampleDesignerForm.cs) - Working example
- [MainForm.Designer.cs](../FishUIDemos/Forms/MainForm.Designer.cs) - Example generated code
